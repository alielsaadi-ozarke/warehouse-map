<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />
  <title>3D Warehouse Map – Shared (Render)</title>

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; width: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #000;
    }

    #app {
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: row;
    }

    #scene {
      flex: 1;
      background: #111;
      height: 100%;
      position: relative;
    }

    #ui {
      width: 360px;
      background: #1b1b1b;
      color: #f2f2f2;
      padding: 14px;
      box-sizing: border-box;
      border-left: 1px solid #333;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
    }

    .panel {
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 12px;
    }

    h2 { margin: 6px 0 4px; font-size: 16px; }
    label { font-size: 13px; color: #bbb; display: block; margin-top: 8px; }

    input[type="text"],
    input[type="number"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #3a3a3a;
      background: #0f0f0f;
      color: #e8e8e8;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    button.primary { background: #2a7fff; color: white; }
    button.secondary { background: #333; color: #eee; }

    .row { display: flex; gap: 8px; }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }
    .colorbox {
      width: 14px; height: 14px;
      border-radius: 3px;
      border: 1px solid #444;
    }

    .footer {
      font-size: 11px;
      color: #888;
      margin-top: auto;
      padding-top: 8px;
    }

    /* Tab bar */
    #tabBar {
      display: flex;
      margin-bottom: 8px;
      border-radius: 999px;
      background: #101010;
      border: 1px solid #2a2a2a;
      overflow: hidden;
    }

    .tab-btn {
      flex: 1;
      padding: 8px 10px;
      font-size: 13px;
      background: transparent;
      color: #ccc;
      border: none;
      cursor: pointer;
      transition: background 0.12s, color 0.12s;
    }

    .tab-btn.active {
      background: #2a7fff;
      color: #fff;
    }

    /* On-map camera controls */
    #cameraControls {
      position: absolute;
      right: 14px;
      bottom: 14px;
      z-index: 5;
      display: flex;
      flex-direction: column;
      gap: 6px;
      pointer-events: auto;
    }

    .cam-pad {
      background: rgba(20,20,20,0.95);
      border-radius: 10px;
      border: 1px solid #333;
      padding: 6px;
      display: grid;
      grid-template-columns: repeat(3, 32px);
      grid-template-rows: repeat(3, 32px);
      gap: 4px;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    .cam-btn {
      background: #222;
      border-radius: 8px;
      border: 1px solid #444;
      color: #eee;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background 0.12s, transform 0.05s;
    }

    .cam-btn:active {
      background: #2a7fff;
      transform: translateY(1px);
    }

    .cam-btn.empty {
      background: transparent;
      border: none;
      cursor: default;
    }

    .zoom-row {
      display: flex;
      justify-content: center;
      gap: 6px;
    }

    .zoom-btn {
      width: 36px;
      height: 36px;
      border-radius: 18px;
      background: rgba(20,20,20,0.95);
      border: 1px solid #333;
      color: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      transition: background 0.12s, transform 0.05s;
    }

    .zoom-btn:active {
      background: #2a7fff;
      transform: translateY(1px);
    }

    /* Multi-SKU rows */
    #itemsContainer {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .item-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .item-row input.item-sku {
      flex: 1.2;
    }

    .item-row input.item-qty {
      flex: 0.6;
    }

    .remove-item-btn {
      padding: 6px 8px;
      background: #552222;
      color: #eee;
      border-radius: 6px;
      border: 1px solid #773333;
      font-size: 13px;
      cursor: pointer;
    }

    .remove-item-btn:active {
      transform: translateY(1px);
      background: #aa3333;
    }

    #addItemBtn {
      margin-top: 6px;
      width: 100%;
    }

    /* Hover tooltip for cubes */
    #cubeTooltip {
      position: absolute;
      z-index: 6;
      background: rgba(10,10,10,0.92);
      border-radius: 6px;
      border: 1px solid #444;
      padding: 6px 8px;
      font-size: 11px;
      color: #f5f5f5;
      pointer-events: none;
      max-width: 220px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      display: none;
      white-space: normal;
    }

    #cubeTooltip .loc-code {
      font-weight: 600;
      margin-bottom: 2px;
    }

    #cubeTooltip .empty-label {
      color: #bbb;
      font-style: italic;
    }

    /* Search status */
    #searchStatus {
      font-size: 12px;
      margin-top: 4px;
      color: #ffb347;
    }

    /* SKU combo (input + dropdown panel) */
    .sku-combo {
      position: relative;
      display: flex;
      align-items: stretch;
      width: 100%;
      margin-top: 4px;
    }

    .sku-combo-input {
      flex: 1;
      border-radius: 6px 0 0 6px;
      border-right: none;
    }

    .sku-combo-toggle {
      width: 34px;
      padding: 0;
      border-radius: 0 6px 6px 0;
      background: #0f0f0f;
      border: 1px solid #3a3a3a;
      border-left: none;
      color: #e8e8e8;
      font-size: 14px;
      cursor: pointer;
    }

    .sku-combo-toggle:active {
      background: #222;
    }

    .sku-combo-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #0f0f0f;
      border: 1px solid #3a3a3a;
      border-radius: 6px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 2px;
      z-index: 10;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    .sku-option {
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .sku-option:hover {
      background: #2a7fff;
    }

    .sku-option.empty {
      font-style: italic;
      color: #888;
      cursor: default;
    }

    @media (max-width: 900px) {
      #app {
        flex-direction: column;
      }
      #scene {
        width: 100%;
        height: 55%;
      }
      #ui {
        width: 100%;
        height: 45%;
        border-left: none;
        border-top: 1px solid #333;
        overflow-y: scroll;
      }

      h2 { font-size: 18px; }
      label { font-size: 14px; }
      input, textarea { font-size: 15px; }
      button { font-size: 15px; padding: 12px; border-radius: 8px; }
      .row { flex-direction: column; }

      #cameraControls {
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>

<body>
<div id="app">
  <div id="scene">
    <!-- On-map camera controls -->
    <div id="cameraControls">
      <div class="cam-pad">
        <div class="cam-btn empty"></div>
        <div class="cam-btn" data-action="pan-up">▲</div>
        <div class="cam-btn empty"></div>

        <div class="cam-btn" data-action="pan-left">◀</div>
        <div class="cam-btn empty"></div>
        <div class="cam-btn" data-action="pan-right">▶</div>

        <div class="cam-btn empty"></div>
        <div class="cam-btn" data-action="pan-down">▼</div>
        <div class="cam-btn empty"></div>
      </div>
      <div class="zoom-row">
        <div class="zoom-btn" data-action="zoom-in">+</div>
        <div class="zoom-btn" data-action="recenter">⟳</div>
        <div class="zoom-btn" data-action="zoom-out">−</div>
      </div>
    </div>

    <!-- Hover tooltip for cubes -->
    <div id="cubeTooltip">
      <div class="loc-code"></div>
      <div class="content"></div>
    </div>
  </div>

  <div id="ui">

    <!-- Tabs -->
    <div id="tabBar">
      <button class="tab-btn active" data-tab="general">General</button>
      <button class="tab-btn" data-tab="admin">Admin</button>
    </div>

    <!-- Admin panel (only visible when Admin tab selected) -->
    <div class="panel" id="adminPanel">
      <h2>Admin – Selected Location</h2>

      <!-- Admin login -->
      <div id="adminLoginBox">
        <label>Admin Password</label>
        <input type="password" id="adminPasswordInput" placeholder="Enter admin password" />
        <button id="adminLoginBtn" class="primary" style="margin-top:8px;">Login as Admin</button>
        <div id="adminLoginStatus" style="font-size:12px; margin-top:4px; color:#ccc;">
          Admin login required to edit locations.
        </div>
      </div>

      <!-- Admin controls (hidden until logged in) -->
      <div id="adminControls" style="display:none; margin-top:8px;">
        <div id="selCode" style="font-size:12px; color:#aaa;">No location selected</div>

        <label>Items in this location</label>
        <div id="itemsContainer"></div>
        <button id="addItemBtn" class="secondary">+ Add SKU</button>

        <label>Location Notes</label>
        <textarea id="notes" rows="3"></textarea>

        <div class="row" style="margin-top:8px;">
          <button id="saveBtn" class="primary">Save</button>
          <button id="clearBtn" class="secondary">Clear</button>
        </div>

        <div class="row">
          <button id="setSrcBtn" class="secondary">Set Source</button>
          <button id="moveHereBtn" class="primary">Move Here</button>
        </div>

        <div id="moveStatus" style="font-size:12px; color:#ccc; margin-top:4px;"></div>
      </div>
    </div>

    <!-- General / Search panel (visible on both tabs) -->
    <div class="panel">
      <h2>Find Locations</h2>

      <div class="row">
        <label style="flex:1">
          Row
          <input id="fRow" type="text" placeholder="A, B, C, D" />
        </label>
      </div>

      <div class="row">
        <label style="flex:1">
          SKU (from list)
          <div class="sku-combo">
            <input
              id="fSkuInput"
              type="text"
              class="sku-combo-input"
              placeholder="Type or pick SKU"
              autocomplete="off"
            />
            <button type="button" id="fSkuToggle" class="sku-combo-toggle">▾</button>
            <div id="fSkuListPanel" class="sku-combo-list"></div>
          </div>
        </label>
      </div>

      <div class="row" style="margin-top:6px;">
        <button id="applyFilters" class="secondary">Apply</button>
        <button id="clearFilters" class="secondary">Reset</button>
      </div>

      <!-- Match navigation moved here so warehouse workers can use it -->
      <div class="row" id="matchNavRow" style="margin-top:6px; display:none;">
        <button id="prevMatchBtn" class="secondary" style="flex:0 0 auto; min-width:80px;">◀ Prev</button>
        <div id="matchInfo" style="flex:1; text-align:center; font-size:12px; color:#ccc; align-self:center;">
          Match 0 of 0
        </div>
        <button id="nextMatchBtn" class="secondary" style="flex:0 0 auto; min-width:80px;">Next ▶</button>
      </div>

      <div id="searchStatus"></div>

      <div style="margin-top:8px;">
        <div class="legend-item"><div class="colorbox" style="background:#1f6f1f"></div>Occupied (any SKU)</div>
        <div class="legend-item"><div class="colorbox" style="background:#555"></div>Empty</div>
        <div class="legend-item"><div class="colorbox" style="background:#9c6f1f"></div>Selected (admin)</div>
        <div class="legend-item"><div class="colorbox" style="background:#2a7fff"></div>Source (admin)</div>
      </div>
    </div>

    <div class="panel">
      <h2>Layout Info</h2>
      <div style="font-size:12px; color:#bbb;">
        Rows: A (6 racks), B (7 double), C (8 double), D (17 single)
      </div>
    </div>

    <div class="footer">
      General tab: search & view. • Admin tab: login to edit locations.
    </div>
  </div>
</div>

<!-- libs -->
<script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<!-- our JS -->
<script src="/js/warehouse-config.js"></script>
<script src="/js/warehouse-api.js"></script>
<script src="/js/warehouse-app.js"></script>
</body>
</html>
